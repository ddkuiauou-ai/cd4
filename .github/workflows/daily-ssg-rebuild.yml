name: Daily SSG Rebuild

on:
  schedule:
    # 매일 오전 6시 (KST 기준)에 실행
    - cron: "0 21 * * *" # UTC 21:00 = KST 06:00
  workflow_dispatch: # 수동 실행 허용

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "pnpm"

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 8

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Setup environment variables
        run: |
          echo "DATABASE_URL=${{ secrets.DATABASE_URL }}" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_SITE_URL=${{ secrets.NEXT_PUBLIC_SITE_URL }}" >> $GITHUB_ENV

      - name: Build static site
        run: pnpm run build
        env:
          NODE_ENV: production

      - name: Deploy to Vercel (or your preferred platform)
        run: |
          # Vercel 배포 명령어
          # npx vercel --prod --token=${{ secrets.VERCEL_TOKEN }}
          echo "배포 스크립트를 여기에 추가하세요"

      - name: Notify completion
        run: |
          echo "✅ SSG 빌드가 완료되었습니다!"
          echo "📊 총 페이지 수: $(find out -name '*.html' | wc -l)"
