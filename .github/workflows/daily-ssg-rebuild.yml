name: Daily SSG Rebuild

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 6ì‹œ (KST ê¸°ì¤€)ì— ì‹¤í–‰
    - cron: "0 21 * * *" # UTC 21:00 = KST 06:00
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "18"
          cache: "pnpm"

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 8

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Setup environment variables
        run: |
          echo "DATABASE_URL=${{ secrets.DATABASE_URL }}" >> $GITHUB_ENV
          echo "NEXT_PUBLIC_SITE_URL=${{ secrets.NEXT_PUBLIC_SITE_URL }}" >> $GITHUB_ENV

      - name: Build static site
        run: pnpm run build
        env:
          NODE_ENV: production

      - name: Deploy to Vercel (or your preferred platform)
        run: |
          # Vercel ë°°í¬ ëª…ë ¹ì–´
          # npx vercel --prod --token=${{ secrets.VERCEL_TOKEN }}
          echo "ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì—¬ê¸°ì— ì¶”ê°€í•˜ì„¸ìš”"

      - name: Notify completion
        run: |
          echo "âœ… SSG ë¹Œë“œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
          echo "ğŸ“Š ì´ í˜ì´ì§€ ìˆ˜: $(find out -name '*.html' | wc -l)"
